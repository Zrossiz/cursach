generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  createdAt DateTime @default(now()) @map("created_at")

  cards Card[]

  @@map("users")
}

model Category {
  id   Int    @id @default(autoincrement())
  name String
  slug String @unique

  goods               Good[]
  cashbacksCategories CardCashbackCategories[]

  @@map("categories")
}

model Good {
  id         Int     @id @default(autoincrement())
  categoryId Int     @map("category_id")
  name       String
  imgPath    String  @map("img_path")
  price      Decimal @db.Decimal(10, 2)

  category Category @relation(fields: [categoryId], references: [id], onDelete: Restrict)

  @@map("goods")
}

model Card {
  id     Int    @id @default(autoincrement())
  userId String @map("user_id")
  name   String

  user               User                     @relation(fields: [userId], references: [id], onDelete: Cascade)
  cashbackCategories CardCashbackCategories[]

  @@map("cards")
}

model CashbackCategory {
  id      Int    @id @default(autoincrement())
  name    String
  percent Int

  cards CardCashbackCategories[]

  @@map("cashback_categories")
}

model CardCashbackCategories {
  id                 Int  @id @default(autoincrement())
  cardId             Int  @map("card_id")
  cashbackCategoryId Int  @map("cashback_category_id")
  categoryId         Int  @map("category_id")

  category         Category?        @relation(fields: [categoryId], references: [id])
  card             Card             @relation(fields: [cardId], references: [id])
  cashbackCategory CashbackCategory @relation(fields: [cashbackCategoryId], references: [id])

  @@unique([cardId, cashbackCategoryId])
  @@map("card_cashback_categories")
}
